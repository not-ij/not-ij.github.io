<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ira‚ÄëOS V2: Musicality ‚Äì Like‚ÄëWindows</title>

  <style>
    :root {
      --accent: #2563eb;
      --accent-soft: rgba(37, 99, 235, 0.3);
      --bg-dark: rgba(15, 23, 42, 0.92);
      --bg-taskbar: rgba(15, 23, 42, 0.9);
      --border-soft: rgba(148, 163, 184, 0.5);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-sm: 8px;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.5);
      --blur-strong: blur(22px);

      --wallpaper-image: url("https://4kwallpapers.com/images/walls/thumbs_3t/14423.jpg");
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      height: 100vh;
      overflow: hidden;
      color: var(--text-main);
      background: #020617;
      position: relative;
      display: flex;
      flex-direction: column;
    }

    /* Wallpaper */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      z-index: -1;
      background-image: var(--wallpaper-image);
      background-position: center;
      background-repeat: no-repeat;
      background-size: cover;
      background-color: #020617;
      transition: background-image 0.25s ease-out,
                  background-size 0.15s ease-out,
                  background-color 0.15s ease-out;
    }

    body[data-wallpaper-mode="fill"]::before {
      background-size: cover;
    }

    body[data-wallpaper-mode="fit"]::before {
      background-size: contain;
      background-color: #000;
    }

    body[data-wallpaper-mode="center"]::before {
      background-size: auto;
      background-repeat: no-repeat;
      background-color: #000;
    }

    /* Desktop */
    .desktop {
      flex: 1;
      position: relative;
      padding: 24px;
      padding-bottom: 110px; /* space for Music Bar + Taskbar */
    }

    .desktop-hint {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: var(--text-muted);
      font-size: 14px;
      text-shadow: 0 8px 18px rgba(0, 0, 0, 0.7);
      pointer-events: none;
    }

    .desktop-hint h1 {
      margin: 0 0 8px;
      font-weight: 500;
      letter-spacing: 0.03em;
    }

    /* Taskbar */
    .taskbar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 46px;
      background: var(--bg-taskbar);
      backdrop-filter: var(--blur-strong);
      -webkit-backdrop-filter: var(--blur-strong);
      border-top: 1px solid rgba(15, 23, 42, 0.9);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 10px;
      gap: 8px;
      z-index: 30;
    }

    .taskbar-left,
    .taskbar-center,
    .taskbar-right {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .taskbar-center {
      justify-content: center;
      flex: 1;
    }

    .taskbar-button {
      height: 30px;
      min-width: 34px;
      border-radius: 999px;
      border: none;
      background: transparent;
      color: var(--text-main);
      padding: 0 10px;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      transition: background 0.15s ease-out, transform 0.08s ease-out;
    }

    .taskbar-button:hover {
      background: rgba(148, 163, 184, 0.22);
    }

    .taskbar-button:active {
      transform: scale(0.96);
    }

    .taskbar-button-icon {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      background: rgba(37, 99, 235, 0.9);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }

    .taskbar-clock {
      font-size: 11px;
      color: var(--text-muted);
      text-align: right;
      line-height: 1.2;
    }
  </style>
</head>

<body>

  <div class="desktop">
    <div class="desktop-hint">
      <h1>Ira‚ÄëOS V2: Musicality</h1>
      <p>Right‚Äëclick to open Settings ‚Ä¢ Click Start to open apps</p>
    </div>
  </div>

  <!-- Taskbar -->
  <div class="taskbar">
    <div class="taskbar-left">
      <button class="taskbar-button" id="startButton">
        <span class="taskbar-button-icon">‚äû</span>
        Start
      </button>
    </div>

    <div class="taskbar-center" id="taskbarApps"></div>

    <div class="taskbar-right">
      <div class="taskbar-clock" id="clockDisplay">
        00:00<br>00/00/0000
      </div>
    </div>
  </div>
  <!-- Start Menu -->
  <div id="startMenu" style="
    position: fixed;
    bottom: 52px;
    left: 50%;
    transform: translateX(-50%) scale(0.96);
    width: 420px;
    background: rgba(15, 23, 42, 0.92);
    backdrop-filter: blur(22px);
    -webkit-backdrop-filter: blur(22px);
    border-radius: 18px;
    border: 1px solid rgba(148, 163, 184, 0.4);
    box-shadow: 0 18px 45px rgba(0,0,0,0.55);
    padding: 18px;
    display: none;
    flex-direction: column;
    gap: 14px;
    z-index: 40;
  ">
    <h3 style="margin: 0; font-size: 15px; font-weight: 500; color: var(--text-main);">
      Apps
    </h3>

    <!-- App Grid -->
    <div id="appGrid" style="
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    ">
      <!-- Apps injected by JS -->
    </div>

    <button id="openSettings" style="
      margin-top: 10px;
      width: 100%;
      height: 36px;
      border-radius: 10px;
      border: none;
      background: rgba(37, 99, 235, 0.25);
      color: var(--text-main);
      font-size: 14px;
      cursor: pointer;
    ">
      Settings
    </button>
  </div>

  <!-- Settings Window -->
  <div id="settingsWindow" class="window" style="
    width: 720px;
    height: 520px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: none;
    position: fixed;
    background: rgba(15,23,42,0.95);
    backdrop-filter: blur(22px);
    -webkit-backdrop-filter: blur(22px);
    border-radius: 18px;
    border: 1px solid rgba(148,163,184,0.4);
    box-shadow: 0 18px 45px rgba(0,0,0,0.55);
    overflow: hidden;
    z-index: 45;
  ">
    <div class="window-header" style="
      height: 42px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 12px;
      border-bottom: 1px solid rgba(148,163,184,0.3);
    ">
      <div class="window-title" style="display: flex; align-items: center; gap: 8px;">
        <span class="window-title-icon">‚öô</span>
        Settings
      </div>
      <div class="window-controls">
        <button class="window-control close" onclick="closeSettings()" style="
          border: none;
          background: transparent;
          color: var(--text-main);
          font-size: 16px;
          cursor: pointer;
        ">‚úï</button>
      </div>
    </div>

    <div style="display: flex; flex: 1; overflow: hidden;">
      
      <!-- Settings Sidebar -->
      <div style="
        width: 180px;
        border-right: 1px solid rgba(148,163,184,0.3);
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      ">
        <button class="settings-tab" data-tab="wallpaper" style="
          height: 32px;
          border-radius: 8px;
          border: none;
          background: transparent;
          color: var(--text-main);
          text-align: left;
          padding-left: 8px;
          cursor: pointer;
        ">Wallpaper</button>

        <button class="settings-tab" data-tab="apps" style="
          height: 32px;
          border-radius: 8px;
          border: none;
          background: transparent;
          color: var(--text-main);
          text-align: left;
          padding-left: 8px;
          cursor: pointer;
        ">Apps</button>

        <button class="settings-tab" data-tab="about" style="
          height: 32px;
          border-radius: 8px;
          border: none;
          background: transparent;
          color: var(--text-main);
          text-align: left;
          padding-left: 8px;
          cursor: pointer;
        ">About</button>
      </div>

      <!-- Settings Content -->
      <div id="settingsContent" style="
        flex: 1;
        padding: 16px;
        overflow-y: auto;
      ">
        <!-- JS injects tab content here -->
      </div>

    </div>
  </div>

  <!-- MUSIC APP WINDOW -->
  <div id="musicWindow" class="window" style="
    width: 860px;
    height: 560px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: none;
    position: fixed;
    background: rgba(15,23,42,0.95);
    backdrop-filter: blur(22px);
    -webkit-backdrop-filter: blur(22px);
    border-radius: 18px;
    border: 1px solid rgba(148,163,184,0.4);
    box-shadow: 0 18px 45px rgba(0,0,0,0.55);
    overflow: hidden;
    z-index: 45;
  ">
    <div class="window-header" style="
      height: 42px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 12px;
      border-bottom: 1px solid rgba(148,163,184,0.3);
    ">
      <div class="window-title" style="display: flex; align-items: center; gap: 8px;">
        <span class="window-title-icon">üéµ</span>
        Music
      </div>
      <div class="window-controls">
        <button class="window-control close" onclick="closeMusic()" style="
          border: none;
          background: transparent;
          color: var(--text-main);
          font-size: 16px;
          cursor: pointer;
        ">‚úï</button>
      </div>
    </div>

    <div style="display: flex; flex: 1; overflow: hidden;">

      <!-- SIDEBAR TAGS -->
      <div id="musicTagsSidebar" style="
        width: 180px;
        border-right: 1px solid rgba(148,163,184,0.3);
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        overflow-y: auto;
      ">
        <h3 style="margin: 0 0 6px; font-size: 14px; font-weight: 500;">Tags</h3>

        <div id="tagList" style="display: flex; flex-direction: column; gap: 6px;">
          <!-- Tags injected by JS -->
        </div>

        <button id="addTagButton" style="
          margin-top: 10px;
          width: 100%;
          height: 32px;
          border-radius: 8px;
          border: none;
          background: rgba(37, 99, 235, 0.25);
          color: var(--text-main);
          font-size: 13px;
          cursor: pointer;
        ">
          + Add Tag
        </button>
      </div>

      <!-- MAIN MUSIC PAGE -->
      <div id="musicMainPage" style="
        flex: 1;
        padding: 16px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 12px;
      ">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h2 style="margin: 0; font-size: 18px; font-weight: 500;">Musics</h2>

          <button id="addMusicButton" style="
            height: 34px;
            padding: 0 14px;
            border-radius: 8px;
            border: none;
            background: rgba(37, 99, 235, 0.25);
            color: var(--text-main);
            font-size: 13px;
            cursor: pointer;
          ">
            + Add Music
          </button>
        </div>

        <!-- Music List -->
        <div id="musicList" style="
          display: flex;
          flex-direction: column;
          gap: 10px;
        ">
          <!-- Tracks injected by JS -->
        </div>
      </div>

    </div>
  </div>
  <!-- MUSIC EDITOR MODAL -->
  <div id="musicEditor" style="
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.96);
    width: 420px;
    background: rgba(15, 23, 42, 0.95);
    backdrop-filter: blur(22px);
    -webkit-backdrop-filter: blur(22px);
    border-radius: 18px;
    border: 1px solid rgba(148,163,184,0.4);
    box-shadow: 0 18px 45px rgba(0,0,0,0.55);
    padding: 18px;
    display: none;
    flex-direction: column;
    gap: 14px;
    z-index: 50;
  ">

    <h2 style="margin: 0; font-size: 17px; font-weight: 500;">Edit Music</h2>

    <!-- Thumbnail -->
    <div style="display: flex; align-items: center; gap: 14px;">
      <div id="editorThumbnailPreview" style="
        width: 64px;
        height: 64px;
        border-radius: 12px;
        background: rgba(255,255,255,0.1);
        background-size: cover;
        background-position: center;
      "></div>

      <div style="display: flex; flex-direction: column; gap: 6px;">
        <label style="font-size: 13px; color: var(--text-muted);">Thumbnail URL</label>
        <input id="editorThumbnailInput" type="text" placeholder="https://..."
          style="
            width: 260px;
            height: 30px;
            border-radius: 8px;
            border: 1px solid rgba(148,163,184,0.3);
            background: rgba(255,255,255,0.05);
            color: var(--text-main);
            padding: 0 8px;
          ">
      </div>
    </div>

    <!-- Music URL -->
    <div style="display: flex; flex-direction: column; gap: 4px;">
      <label style="font-size: 13px; color: var(--text-muted);">Music URL</label>
      <input id="editorURLInput" type="text" placeholder="https://..."
        style="
          width: 100%;
          height: 32px;
          border-radius: 8px;
          border: 1px solid rgba(148,163,184,0.3);
          background: rgba(255,255,255,0.05);
          color: var(--text-main);
          padding: 0 8px;
        ">
    </div>

    <!-- Name -->
    <div style="display: flex; flex-direction: column; gap: 4px;">
      <label style="font-size: 13px; color: var(--text-muted);">Name</label>
      <input id="editorNameInput" type="text" placeholder="Track name"
        style="
          width: 100%;
          height: 32px;
          border-radius: 8px;
          border: 1px solid rgba(148,163,184,0.3);
          background: rgba(255,255,255,0.05);
          color: var(--text-main);
          padding: 0 8px;
        ">
    </div>

    <!-- Description -->
    <div style="display: flex; flex-direction: column; gap: 4px;">
      <label style="font-size: 13px; color: var(--text-muted);">Description</label>
      <textarea id="editorDescInput" placeholder="Description..."
        style="
          width: 100%;
          height: 70px;
          border-radius: 8px;
          border: 1px solid rgba(148,163,184,0.3);
          background: rgba(255,255,255,0.05);
          color: var(--text-main);
          padding: 6px 8px;
          resize: none;
        "></textarea>
    </div>

    <!-- Tags -->
    <div style="display: flex; flex-direction: column; gap: 4px;">
      <label style="font-size: 13px; color: var(--text-muted);">Tags</label>
      <select id="editorTagSelect" multiple size="4"
        style="
          width: 100%;
          border-radius: 8px;
          border: 1px solid rgba(148,163,184,0.3);
          background: rgba(255,255,255,0.05);
          color: var(--text-main);
          padding: 6px;
        ">
        <!-- Tags injected by JS -->
      </select>
    </div>

    <!-- Buttons -->
    <div style="display: flex; justify-content: space-between; margin-top: 10px;">
      <button id="deleteMusicButton" style="
        height: 34px;
        padding: 0 14px;
        border-radius: 8px;
        border: none;
        background: rgba(239,68,68,0.25);
        color: #fecaca;
        font-size: 13px;
        cursor: pointer;
      ">
        Delete
      </button>

      <button id="saveMusicButton" style="
        height: 34px;
        padding: 0 14px;
        border-radius: 8px;
        border: none;
        background: rgba(37, 99, 235, 0.35);
        color: var(--text-main);
        font-size: 13px;
        cursor: pointer;
      ">
        Save
      </button>
    </div>

  </div>

  <!-- GLOBAL MUSIC BAR -->
  <div id="musicBar" style="
    position: fixed;
    left: 50%;
    transform: translateX(-50%);
    bottom: 48px;
    width: min(640px, 96vw);
    height: 56px;
    background: rgba(15, 23, 42, 0.95);
    backdrop-filter: blur(22px);
    -webkit-backdrop-filter: blur(22px);
    border-radius: 999px;
    border: 1px solid rgba(148,163,184,0.7);
    box-shadow: 0 18px 45px rgba(0,0,0,0.6);
    display: flex;
    align-items: center;
    padding: 6px 14px;
    gap: 12px;
    z-index: 25;
  ">

    <!-- Thumbnail -->
    <div id="barThumb" style="
      width: 42px;
      height: 42px;
      border-radius: 10px;
      background: rgba(255,255,255,0.1);
      background-size: cover;
      background-position: center;
    "></div>

    <!-- Track Info -->
    <div style="flex: 1; display: flex; flex-direction: column; overflow: hidden;">
      <div id="barTitle" style="
        font-size: 14px;
        font-weight: 500;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      ">No track</div>

      <div id="barDesc" style="
        font-size: 11px;
        color: var(--text-muted);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      ">‚Äî</div>
    </div>

    <!-- Controls -->
    <div style="display: flex; align-items: center; gap: 10px;">
      <button id="barPrev" style="
        width: 32px;
        height: 32px;
        border-radius: 50%;
        border: none;
        background: rgba(255,255,255,0.08);
        color: var(--text-main);
        cursor: pointer;
      ">‚èÆ</button>

      <button id="barPlay" style="
        width: 38px;
        height: 38px;
        border-radius: 50%;
        border: none;
        background: rgba(37,99,235,0.35);
        color: var(--text-main);
        font-size: 15px;
        cursor: pointer;
      ">‚ñ∂</button>

      <button id="barNext" style="
        width: 32px;
        height: 32px;
        border-radius: 50%;
        border: none;
        background: rgba(255,255,255,0.08);
        color: var(--text-main);
        cursor: pointer;
      ">‚è≠</button>
    </div>

    <!-- Hidden audio element -->
    <audio id="audioPlayer"></audio>

  </div>
  <!-- SETTINGS TAB TEMPLATES -->

  <!-- Wallpaper Tab -->
  <template id="tpl-settings-wallpaper">
    <h2 style="margin: 0 0 12px; font-size: 18px;">Wallpaper</h2>

    <label style="font-size: 13px; color: var(--text-muted);">Wallpaper URL</label>
    <input id="wallpaperURL" type="text" placeholder="https://..."
      style="
        width: 100%;
        height: 32px;
        border-radius: 8px;
        border: 1px solid rgba(148,163,184,0.3);
        background: rgba(255,255,255,0.05);
        color: var(--text-main);
        padding: 0 8px;
        margin-bottom: 12px;
      ">

    <button id="applyWallpaper" style="
      height: 34px;
      padding: 0 14px;
      border-radius: 8px;
      border: none;
      background: rgba(37,99,235,0.35);
      color: var(--text-main);
      font-size: 13px;
      cursor: pointer;
      margin-bottom: 20px;
    ">
      Apply Wallpaper
    </button>

    <h3 style="margin: 0 0 8px; font-size: 15px;">Wallpaper Mode</h3>

    <div style="display: flex; gap: 10px;">
      <button class="wallpaper-mode" data-mode="fill"
        style="flex: 1; height: 32px; border-radius: 8px; border: none; background: rgba(255,255,255,0.08); color: var(--text-main); cursor: pointer;">
        Fill
      </button>

      <button class="wallpaper-mode" data-mode="fit"
        style="flex: 1; height: 32px; border-radius: 8px; border: none; background: rgba(255,255,255,0.08); color: var(--text-main); cursor: pointer;">
        Fit
      </button>

      <button class="wallpaper-mode" data-mode="center"
        style="flex: 1; height: 32px; border-radius: 8px; border: none; background: rgba(255,255,255,0.08); color: var(--text-main); cursor: pointer;">
        Center
      </button>
    </div>
  </template>

  <!-- Apps Manager Tab -->
  <template id="tpl-settings-apps">
    <h2 style="margin: 0 0 12px; font-size: 18px;">Apps</h2>

    <div id="appsList" style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 14px;">
      <!-- Apps injected by JS -->
    </div>

    <button id="addAppButton" style="
      height: 34px;
      padding: 0 14px;
      border-radius: 8px;
      border: none;
      background: rgba(37,99,235,0.35);
      color: var(--text-main);
      font-size: 13px;
      cursor: pointer;
    ">
      + Add App
    </button>
  </template>

  <!-- About Tab -->
  <template id="tpl-settings-about">
    <h2 style="margin: 0 0 12px; font-size: 18px;">About Ira‚ÄëOS</h2>

    <p style="font-size: 14px; color: var(--text-muted); line-height: 1.5;">
      Ira‚ÄëOS V2: Musicality<br>
      A modular, tag‚Äëdriven, music‚Äëpowered desktop environment.<br><br>
      Designed by Sinu.<br>
      Engineered by Ira.<br>
      Built for remixing.
    </p>
  </template>

  <!-- FULL JAVASCRIPT ENGINE -->
  <script>
    /* ============================================================
       IRA‚ÄëOS V2: MUSICALITY ‚Äî FULL JAVASCRIPT ENGINE
    ============================================================ */

    let apps = JSON.parse(localStorage.getItem("apps") || "[]");
    let musics = JSON.parse(localStorage.getItem("musics") || "[]");
    let tags = JSON.parse(localStorage.getItem("tags") || "[]");

    let editingMusicId = null;

    /* CLOCK */
    function updateClock() {
      const now = new Date();
      const t = now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
      const d = now.toLocaleDateString();
      document.getElementById("clockDisplay").innerHTML = `${t}<br>${d}`;
    }
    setInterval(updateClock, 1000);
    updateClock();

    /* START MENU */
    const startMenu = document.getElementById("startMenu");
    document.getElementById("startButton").onclick = () => {
      startMenu.style.display = startMenu.style.display === "flex" ? "none" : "flex";
    };

    /* WINDOW HELPERS */
    function openWindow(id) {
      document.getElementById(id).style.display = "flex";
    }
    function closeWindow(id) {
      document.getElementById(id).style.display = "none";
    }
    function closeSettings() { closeWindow("settingsWindow"); }
    function closeMusic() { closeWindow("musicWindow"); }

    /* SETTINGS TABS */
    const settingsContent = document.getElementById("settingsContent");
    const settingsTabs = document.querySelectorAll(".settings-tab");

    settingsTabs.forEach(btn => {
      btn.onclick = () => {
        settingsTabs.forEach(b => b.style.background = "transparent");
        btn.style.background = "rgba(255,255,255,0.08)";
        loadSettingsTab(btn.dataset.tab);
      };
    });

    function loadSettingsTab(tab) {
      const tpl = document.getElementById(`tpl-settings-${tab}`);
      settingsContent.innerHTML = "";
      settingsContent.appendChild(tpl.content.cloneNode(true));

      if (tab === "wallpaper") initWallpaperTab();
      if (tab === "apps") initAppsTab();
    }

    /* WALLPAPER TAB */
    function initWallpaperTab() {
      const urlInput = document.getElementById("wallpaperURL");
      const applyBtn = document.getElementById("applyWallpaper");

      applyBtn.onclick = () => {
        document.documentElement.style.setProperty("--wallpaper-image", `url("${urlInput.value}")`);
        localStorage.setItem("wallpaper", urlInput.value);
      };

      document.querySelectorAll(".wallpaper-mode").forEach(btn => {
        btn.onclick = () => {
          document.body.dataset.wallpaperMode = btn.dataset.mode;
          localStorage.setItem("wallpaperMode", btn.dataset.mode);
        };
      });
    }

    /* APPS MANAGER */
    function initAppsTab() {
      const list = document.getElementById("appsList");
      list.innerHTML = "";

      apps.forEach((app, i) => {
        const row = document.createElement("div");
        row.style.display = "flex";
        row.style.justifyContent = "space-between";
        row.style.alignItems = "center";

        row.innerHTML = `
          <span>${app.name}</span>
          <button data-i="${i}" style="
            height: 28px;
            padding: 0 10px;
            border-radius: 6px;
            border: none;
            background: rgba(239,68,68,0.25);
            color: #fecaca;
            cursor: pointer;
          ">Remove</button>
        `;

        row.querySelector("button").onclick = () => {
          apps.splice(i, 1);
          saveApps();
          initAppsTab();
          renderAppGrid();
        };

        list.appendChild(row);
      });

      document.getElementById("addAppButton").onclick = () => {
        const name = prompt("App name:");
        if (!name) return;
        apps.push({ name });
        saveApps();
        initAppsTab();
        renderAppGrid();
      };
    }

    function saveApps() {
      localStorage.setItem("apps", JSON.stringify(apps));
    }

    /* APP GRID */
    function renderAppGrid() {
      const grid = document.getElementById("appGrid");
      grid.innerHTML = "";

      const musicBtn = document.createElement("button");
      musicBtn.className = "taskbar-button";
      musicBtn.innerHTML = `<span class="taskbar-button-icon">üéµ</span>Music`;
      musicBtn.onclick = () => openWindow("musicWindow");
      grid.appendChild(musicBtn);

      apps.forEach(app => {
        const btn = document.createElement("button");
        btn.className = "taskbar-button";
        btn.innerHTML = `<span class="taskbar-button-icon">üì¶</span>${app.name}`;
        grid.appendChild(btn);
      });
    }
    renderAppGrid();

    /* TAG SYSTEM */
    function renderTags() {
      const list = document.getElementById("tagList");
      list.innerHTML = "";

      tags.forEach((tag, i) => {
        const div = document.createElement("div");
        div.style.display = "flex";
        div.style.justifyContent = "space-between";

        div.innerHTML = `
          <span>${tag}</span>
          <button data-i="${i}" style="
            border: none;
            background: rgba(239,68,68,0.25);
            color: #fecaca;
            border-radius: 6px;
            padding: 2px 6px;
            cursor: pointer;
          ">‚úï</button>
        `;

        div.querySelector("button").onclick = () => {
          tags.splice(i, 1);
          saveTags();
          renderTags();
          renderTagSelect();
        };

        list.appendChild(div);
      });

      document.getElementById("addTagButton").onclick = () => {
        const t = prompt("New tag:");
        if (!t) return;
        tags.push(t);
        saveTags();
        renderTags();
        renderTagSelect();
      };
    }

    function saveTags() {
      localStorage.setItem("tags", JSON.stringify(tags));
    }

    function renderTagSelect() {
      const sel = document.getElementById("editorTagSelect");
      if (!sel) return;
      sel.innerHTML = "";
      tags.forEach(t => {
        const opt = document.createElement("option");
        opt.value = t;
        opt.textContent = t;
        sel.appendChild(opt);
      });
    }

    renderTags();

    /* MUSIC LIST */
    function renderMusicList() {
      const list = document.getElementById("musicList");
      list.innerHTML = "";

      musics.forEach((m, i) => {
        const row = document.createElement("div");
        row.style.display = "flex";
        row.style.alignItems = "center";
        row.style.gap = "12px";
        row.style.background = "rgba(255,255,255,0.05)";
        row.style.padding = "8px";
        row.style.borderRadius = "10px";
        row.style.cursor = "pointer";

        row.innerHTML = `
          <div style="
            width: 48px;
            height: 48px;
            border-radius: 10px;
            background-image: url('${m.thumb}');
            background-size: cover;
            background-position: center;
          "></div>

          <div style="flex: 1;">
            <div style="font-size: 14px; font-weight: 500;">${m.name}</div>
            <div style="font-size: 11px; color: var(--text-muted);">${m.desc}</div>
          </div>

          <button data-i="${i}" style="
            height: 30px;
            padding: 0 10px;
            border-radius: 8px;
            border: none;
            background: rgba(37,99,235,0.35);
            color: var(--text-main);
            cursor: pointer;
          ">Edit</button>
        `;

        row.onclick = () => playMusic(i);
        row.querySelector("button").onclick = (e) => {
          e.stopPropagation();
          openMusicEditor(i);
        };

        list.appendChild(row);
      });
    }

    renderMusicList();

    /* MUSIC EDITOR */
    function openMusicEditor(i) {
      editingMusicId = i;

      const m = musics[i];

      document.getElementById("editorThumbnailInput").value = m.thumb;
      document.getElementById("editorURLInput").value = m.url;
      document.getElementById("editorNameInput").value = m.name;
      document.getElementById("editorDescInput").value = m.desc;

      renderTagSelect();

      const sel = document.getElementById("editorTagSelect");
      [...sel.options].forEach(opt => {
        opt.selected = m.tags.includes(opt.value);
      });

      document.getElementById("editorThumbnailPreview").style.backgroundImage = `url('${m.thumb}')`;

      openWindow("musicEditor");
    }

    document.getElementById("editorThumbnailInput").oninput = (e) => {
      document.getElementById("editorThumbnailPreview").style.backgroundImage = `url('${e.target.value}')`;
    };

    document.getElementById("saveMusicButton").onclick = () => {
      const m = musics[editingMusicId];

      m.thumb = document.getElementById("editorThumbnailInput").value;
      m.url = document.getElementById("editorURLInput").value;
      m.name = document.getElementById("editorNameInput").value;
      m.desc = document.getElementById("editorDescInput").value;

      const sel = document.getElementById("editorTagSelect");
      m.tags = [...sel.selectedOptions].map(o => o.value);

      saveMusics();
      renderMusicList();
      closeWindow("musicEditor");
    };

    document.getElementById("deleteMusicButton").onclick = () => {
      musics.splice(editingMusicId, 1);
      saveMusics();
      renderMusicList();
      closeWindow("musicEditor");
    };

    function saveMusics() {
      localStorage.setItem("musics", JSON.stringify(musics));
    }

    /* ADD MUSIC */
    document.getElementById("addMusicButton").onclick = () => {
      musics.push({
        thumb: "",
        url: "",
        name: "New Track",
        desc: "",
        tags: []
      });
      saveMusics();
      renderMusicList();
    };

    /* MUSIC PLAYER */
    const audio = document.getElementById("audioPlayer");

    function playMusic(i) {
      const m = musics[i];
      if (!m) return;

      audio.src = m.url;
      audio.play();

      document.getElementById("barThumb").style.backgroundImage = `url('${m.thumb}')`;
      document.getElementById("barTitle").textContent = m.name;
      document.getElementById("barDesc").textContent = m.desc;

      document.getElementById("barPlay").textContent = "‚è∏";
    }

    document.getElementById("barPlay").onclick = () => {
      if (audio.paused) {
        audio.play();
        document.getElementById("barPlay").textContent = "‚è∏";
      } else {
        audio.pause();
        document.getElementById("barPlay").textContent = "‚ñ∂";
      }
    };

    /* LOAD SAVED WALLPAPER */
    const savedWallpaper = localStorage.getItem("wallpaper");
    if (savedWallpaper) {
      document.documentElement.style.setProperty("--wallpaper-image", `url("${savedWallpaper}")`);
    }

    const savedMode = localStorage.getItem("wallpaperMode");
    if (savedMode) {
      document.body.dataset.wallpaperMode = savedMode;
    }
  </script>

</body>
</html>
